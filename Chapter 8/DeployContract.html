<!DOCTYPE html>
<html lang="en">
<script src="./node_modules/web3/dist/web3.min.js"></script>
<body>
    <script>

        async function loadWeb3() {
            //---if MetaMask is available on your web browser---
            if (window.ethereum) {                
                web3 = new Web3(window.ethereum);
                //---connect to an account---
                const account = await window.ethereum.request(
                    {method: 'eth_requestAccounts'});
                alert("Account: " + account);
            } else {            
                //---set the provider you want from Web3.providers---            
                web3 = new Web3(
                    new Web3.providers.HttpProvider(
                        "http://localhost:8545"));

                //---get all accounts---
                const accounts = await web3.eth.getAccounts();                
                alert("Account: " + accounts[0]);
            }            
        }

        async function getCurrentAccount() {
            const accounts = await web3.eth.getAccounts();
            console.log(accounts)
            return accounts[0];
        }

        async function deployContract() {
            //---get the account---
            const account = await getCurrentAccount();                                

            let bytecode = "6080604052336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555034801561005057600080fd5b506108e9806100606000396000f3fe60806040526004361061003f5760003560e01c80631420e00c1461004457806341c0e1b51461006d578063793cd71e14610084578063c4dc563a1461009b575b600080fd5b34801561005057600080fd5b5061006b600480360381019061006691906104c9565b6100b7565b005b34801561007957600080fd5b5061008261015b565b005b34801561009057600080fd5b50610099610222565b005b6100b560048036038101906100b091906104c9565b610319565b005b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610145576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161013c9061068b565b60405180910390fd5b61015761015283836103ba565b610416565b5050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146101e9576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016101e0906106cb565b60405180910390fd5b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146102b0576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016102a7906106ab565b60405180910390fd5b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc479081150290604051600060405180830381858888f19350505050158015610316573d6000803e3d6000fd5b50565b6103e8341461035d576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103549061066b565b60405180910390fd5b7f56a563a228126ef95301e2cc755756dc4ed6193cf17e29d015df9de2b9ffe9f73383836001600061038f88886103ba565b8152602001908152602001600020546040516103ae949392919061062b565b60405180910390a15050565b6000600283836040516103ce929190610612565b602060405180830381855afa1580156103eb573d6000803e3d6000fd5b5050506040513d601f19601f8201168201806040525081019061040e919061049c565b905092915050565b43600160008381526020019081526020016000208190555050565b6000815190506104408161089c565b92915050565b60008083601f84011261045c5761045b610761565b5b8235905067ffffffffffffffff8111156104795761047861075c565b5b60208301915083600182028301111561049557610494610766565b5b9250929050565b6000602082840312156104b2576104b1610770565b5b60006104c084828501610431565b91505092915050565b600080602083850312156104e0576104df610770565b5b600083013567ffffffffffffffff8111156104fe576104fd61076b565b5b61050a85828601610446565b92509250509250929050565b61051f81610707565b82525050565b600061053183856106eb565b935061053e83858461074d565b82840190509392505050565b600061055683856106f6565b935061056383858461074d565b61056c83610775565b840190509392505050565b6000610584601b836106f6565b915061058f82610786565b602082019050919050565b60006105a76034836106f6565b91506105b2826107af565b604082019050919050565b60006105ca6028836106f6565b91506105d5826107fe565b604082019050919050565b60006105ed6021836106f6565b91506105f88261084d565b604082019050919050565b61060c81610743565b82525050565b600061061f828486610525565b91508190509392505050565b60006060820190506106406000830187610516565b818103602083015261065381858761054a565b90506106626040830184610603565b95945050505050565b6000602082019050818103600083015261068481610577565b9050919050565b600060208201905081810360008301526106a48161059a565b9050919050565b600060208201905081810360008301526106c4816105bd565b9050919050565b600060208201905081810360008301526106e4816105e0565b9050919050565b600081905092915050565b600082825260208201905092915050565b600061071282610723565b9050919050565b6000819050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b82818337600083830152505050565b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f546869732063616c6c2072657175697265732031303030207765690000000000600082015250565b7f4f6e6c7920746865206f776e6572206f6620636f6e74726163742063616e207360008201527f746f7265207468652063726564656e7469616c73000000000000000000000000602082015250565b7f4f6e6c7920746865206f776e6572206f6620636f6e74726163742063616e206360008201527f617368206f757421000000000000000000000000000000000000000000000000602082015250565b7f4f6e6c79206f776e65722063616e206b696c6c207468697320636f6e7472616360008201527f7400000000000000000000000000000000000000000000000000000000000000602082015250565b6108a581610719565b81146108b057600080fd5b5056fea26469706673582212207106fa1c037088be51a473dc079f235a2cc50f86f23841334d16cf0cfb27c2b764736f6c63430008070033"
            let abi = [ { "anonymous": false, "inputs": [ { "indexed": false, "internalType": "address", "name": "from", "type": "address" }, { "indexed": false, "internalType": "string", "name": "document", "type": "string" }, { "indexed": false, "internalType": "uint256", "name": "blockNumber", "type": "uint256" } ], "name": "Result", "type": "event" }, { "inputs": [], "name": "cashOut", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [ { "internalType": "string", "name": "document", "type": "string" } ], "name": "checkEduCredentials", "outputs": [], "stateMutability": "payable", "type": "function" }, { "inputs": [], "name": "kill", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [ { "internalType": "string", "name": "document", "type": "string" } ], "name": "storeEduCredentials", "outputs": [], "stateMutability": "nonpayable", "type": "function" } ];
            let contract = new web3.eth.Contract(abi);
            
            web3.eth.estimateGas({data: bytecode},
                function(error, result){
                    if (!error){
                        contract.deploy(
                            {
                                from : account,
                                data : bytecode,
                                gas : result
                            }, function (err, contract) {
                                if (err) {
                                    alert(err);
                                    return;
                                } else if (contract.address){
                                    alert('Contract address: '
                                        + contract.address);
                                }
                        });
                    } else {
                        alert('err = ' + error);
                    }
                }
            );
        }

        async function load() {
            await loadWeb3();
            await deployContract();
        }        
        load();
    </script>
</body>
</html>
